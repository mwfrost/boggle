<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <!-- Internal styles -->
    <style>
        #lettergrid {
            font-family: 'DejaVu Sans Mono', monospace;
            font-size: 4em;
            line-height: 1em;
        }
    </style>

    <title>Boggle Graph</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<script type="text/javascript">
    $(document).ready(
        function () {
            //constants
            const GRID_WIDTH = 4;
            const GRID_HEIGHT = 4;
            const USE_QU_SQUARE = false;
            const ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"

            // style the objects according to the constants
            $('#lettergrid').attr('cols', GRID_WIDTH );
            $('#lettergrid').attr('rows', GRID_HEIGHT);

            // functions
            class LetterGrid{
                // using a constructor instead of just declaring the function
                // allows repeated reshuffling
                constructor() {
                // generate an array of strings whose keys reflect 
                // their x,y coordinates
                var letters = [];
                var letterCount = GRID_HEIGHT * GRID_WIDTH;
                for (var i = 0; i < letterCount; i++) {
                    letters.push(
                        ALPHABET.charAt(Math.floor(Math.random() *
                            ALPHABET.length))
                    );
                }
                this.letters = letters;
            }
            }
            
            function getCoordinatesByKey(key) {
                // given a grid cell's key, return its x,y Cartesian location
                // modulo syntax from 
                // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Remainder
                y = ((key % GRID_HEIGHT) + GRID_HEIGHT) % GRID_HEIGHT;
                x = Math.floor(key / GRID_WIDTH);
                return [x, y]
            }

            function getKeyByCoordinates(x, y) {
                // given an x,y Cartesian location, return the key of the letter
                key = x * GRID_WIDTH + y
                return key
            }

            // create a map of index keys to coordinate pairs
            var keyCoordinates = new Map();
            for (var k = 0; k < GRID_WIDTH * GRID_HEIGHT ; k++) {
                keyCoordinates.set(k, getCoordinatesByKey(k));
            }

            function getAdjacentCoordinates(rowcol){
                row=rowcol[0]
                col=rowcol[1]
                nearbypairs = [
                    [col-1,row-1] ,[col,row-1]  , [col+1, row-1],
                    [col-1,row] ,                 [col+1, row],
                    [col-1,row+1] ,[col,row+1]  , [col+1, row+1]
                ]
                gridpairs = Array.from(keyCoordinates.values());
                // using two loops is ugly but will do for now
                validpairs = []
                for (let n = 0; n < nearbypairs.length; n++) {
                    for (let g = 0; g < gridpairs.length; g++) {
                    if (
                        JSON.stringify(nearbypairs[n]) === JSON.stringify(gridpairs[g])
                    ){validpairs.push(nearbypairs[n]);}
                }
                }
                return validpairs;
            }
            function fillGrid() {
                // turn the array of letters into a series of rows
                displayLetters = "";
                
                for (var k = 0; k < GRID_WIDTH * GRID_HEIGHT ; k++){
                    xy = getCoordinatesByKey(letters, k)
                }

                for (var r = 0; r < GRID_HEIGHT ; r++) {
                    displayLetters = displayLetters + letters.slice(r * GRID_WIDTH, r * GRID_WIDTH + GRID_WIDTH).join("")+"\n" ;
                }
                return displayLetters;
            }

            function buildAdjacency(){
                // for each key in the array, identify 
                // which other keys it can be adjacent to
                var graph = new Map();
                // iterate through the keys, assigning adjacent keys
                for (var k = 0; k < GRID_WIDTH * GRID_HEIGHT ; k++){
                    kxy = keyCoordinates.get(k);
                    var adjacentcoords = getAdjacentCoordinates(kxy);
                    var adjacentkeys = adjacentcoords.map((pair) => getKeyByCoordinates(pair[0], pair[1]))
                    graph.set(k, adjacentkeys);
                }
                return graph;
            }

            // initialize the words to search for
            let wordlistpromise = new Promise(function (resolve, reject) {
                    resolve("am, be, do, is, as, an, at, by, in, no, of, on, so, to, up,he, it, me, us, we");
                    
                    reject("There was an error building the word list.");
                });
            
            wordlistpromise.then(function(value) {
                var node = document.createTextNode(value);
                $('#wordlist').append(node);
                });
            

            console.log($('#wordlist').innerHTML);

            // build the adjacency graph on page load, not on click
            adjacencyGraph = buildAdjacency();
            console.log(adjacencyGraph);

            letterGrid = new LetterGrid();
            var letters = letterGrid.letters;
            var grid = fillGrid();
            $('#lettergrid').html(grid);

            

            $('#shuffle').click(function () {
                letterGrid = new LetterGrid();
                
                letters = letterGrid.letters;
                var grid = fillGrid();
                $('#lettergrid').html(grid);
            });
        });
</script>
</head>

<body>
    <main role="main" class="container">
        <div class="starter-template"></div>
        
            <h1>Boggletron 3000</h1>
            <div class="row mb-3">
                <div class="col-4">
                    <button id="shuffle" class="lead">Click here to shuffle</button>
                    <textarea id="lettergrid"></textarea>
                </div>
                <div class="col-4 themed-grid-col"><p id="wordlist"></p></div>
                <div class="col-4">Right column</div>
              </div>
        </div>
    </main>

</body>

</html>